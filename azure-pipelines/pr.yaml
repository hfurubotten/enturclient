pool:
  vmImage: "ubuntu-latest"

steps:
  - template: templates/init-step.yaml
  - bash: |
      source $HOME/.poetry/env
      poetry run black . --check --diff
    displayName: black check
  - bash: |
      source $HOME/.poetry/env
      poetry run isort --check-only
    displayName: import sorting
  - bash: |
      source $HOME/.poetry/env
      poetry run pylint enturclient
    displayName: linting
  - bash: |
      source $HOME/.poetry/env
      poetry run mypy enturclient --ignore-missing-imports --follow-imports=silent --warn-redundant-casts --warn-unused-configs --strict-equality
    displayName: typing checks
  - bash: |
      source $HOME/.poetry/env
      poetry run pytest --cov=enturclient --cov-report=xml --cov-report=html --junitxml=junit/test-results.xml
    displayName: tests
  - task: PublishTestResults@2
    condition: succeededOrFailed()
    displayName: Publish test results
    inputs:
      testResultsFiles: "**/test-*.xml"
      testRunTitle: Test results
